Version 4
SHEET 1 2356 948
WIRE -304 -256 -304 -288
WIRE 464 -224 448 -224
WIRE 528 -224 464 -224
WIRE 2144 -208 2096 -208
WIRE 2240 -208 2208 -208
WIRE 528 -192 528 -224
WIRE -304 -144 -304 -176
WIRE 448 -112 448 -224
WIRE 2096 -112 2096 -208
WIRE 2128 -112 2096 -112
WIRE 2240 -112 2240 -208
WIRE 2240 -112 2208 -112
WIRE 528 -96 528 -112
WIRE 1872 -80 1872 -96
WIRE 384 -64 304 -64
WIRE -48 -48 -96 -48
WIRE 112 -48 16 -48
WIRE 752 -32 704 -32
WIRE 864 -32 752 -32
WIRE 1024 -32 864 -32
WIRE 1328 -32 1024 -32
WIRE -384 0 -384 -32
WIRE 2176 0 2176 -16
WIRE -96 16 -96 -48
WIRE 448 16 448 -16
WIRE 1872 16 1872 0
WIRE 1952 16 1872 16
WIRE 2096 16 2096 -112
WIRE 2096 16 2032 16
WIRE 2144 16 2096 16
WIRE 448 32 448 16
WIRE 704 32 704 -32
WIRE 864 32 864 -32
WIRE 1024 32 1024 -32
WIRE 1328 32 1328 -32
WIRE 2240 32 2240 -112
WIRE 2240 32 2208 32
WIRE 2272 32 2240 32
WIRE 1952 48 1872 48
WIRE 2096 48 2032 48
WIRE 2144 48 2096 48
WIRE 2240 48 2240 32
WIRE 1872 64 1872 48
WIRE 2096 64 2096 48
WIRE 2176 80 2176 64
WIRE 0 96 0 48
WIRE -208 144 -256 144
WIRE -96 144 -96 16
WIRE -96 144 -128 144
WIRE -64 144 -96 144
WIRE 704 144 704 96
WIRE 768 144 704 144
WIRE 864 144 864 96
WIRE 864 144 768 144
WIRE 1024 144 1024 112
WIRE 1024 144 864 144
WIRE 1328 144 1328 112
WIRE 112 160 112 -48
WIRE 112 160 64 160
WIRE 208 160 112 160
WIRE 304 160 304 -64
WIRE 304 160 208 160
WIRE 336 160 304 160
WIRE 448 160 448 112
WIRE 448 160 416 160
WIRE 496 160 448 160
WIRE 1872 160 1872 144
WIRE 2096 160 2096 144
WIRE 2240 160 2240 128
WIRE -384 176 -384 80
WIRE -352 176 -384 176
WIRE -64 176 -352 176
WIRE 704 192 704 144
WIRE 864 192 864 144
WIRE 1024 192 1024 144
WIRE -384 224 -384 176
WIRE 448 224 448 160
WIRE 704 304 704 256
WIRE 864 304 864 256
WIRE 864 304 704 304
WIRE 1024 304 1024 272
WIRE 1024 304 864 304
WIRE 864 320 864 304
WIRE 448 336 448 304
WIRE -384 368 -384 304
WIRE 448 368 448 336
WIRE 0 384 0 224
WIRE 304 416 304 160
WIRE 384 416 304 416
WIRE 448 496 448 464
WIRE 304 576 304 560
WIRE 672 576 672 560
WIRE 304 672 304 656
WIRE 672 672 672 656
WIRE 304 816 304 800
WIRE 672 816 672 800
WIRE 1088 816 1088 800
WIRE 304 912 304 896
WIRE 672 912 672 896
WIRE 1088 912 1088 896
FLAG -304 -144 0
FLAG 0 384 0
FLAG -256 144 FB
FLAG -384 -32 CAP
FLAG -384 368 0
FLAG 496 160 FB
FLAG 864 320 0
FLAG 768 144 FB
FLAG 752 -32 CAP
FLAG 1328 144 0
FLAG -352 176 REF
FLAG -304 -288 VCC
FLAG 1872 -96 0
FLAG 1872 160 0
FLAG 2176 80 0
FLAG 2176 -16 VCC
FLAG 2240 160 0
FLAG 2272 32 CURR
FLAG 208 160 OUT
FLAG 448 496 0
FLAG 2096 160 0
FLAG 448 16 SN
FLAG 448 336 SP
FLAG 528 -96 0
FLAG 464 -224 6V
FLAG 304 672 0
FLAG 304 560 P_NPN
FLAG 672 672 0
FLAG 672 560 P_lowR
FLAG 304 912 0
FLAG 304 800 P_PNP
FLAG 672 912 0
FLAG 672 800 P_highR
FLAG -96 16 REFN
FLAG 0 48 6V
FLAG 1088 912 0
FLAG 1088 800 ENERGY_LOST
SYMBOL voltage -304 -272 R0
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 24
SYMBOL res -400 -16 R0
SYMATTR InstName R2
SYMATTR Value 1Meg
SYMBOL res -400 208 R0
SYMATTR InstName R3
SYMATTR Value 1Meg
SYMBOL cap 688 32 R0
SYMATTR InstName C1
SYMATTR Value {A*110}
SYMATTR SpiceLine Rser=18m
SYMBOL cap 848 32 R0
SYMATTR InstName C2
SYMATTR Value {A*110}
SYMATTR SpiceLine Rser=18m
SYMBOL cap 688 192 R0
SYMATTR InstName C3
SYMATTR Value {B*110}
SYMATTR SpiceLine Rser=18m
SYMBOL cap 848 192 R0
SYMATTR InstName C4
SYMATTR Value {B*110}
SYMATTR SpiceLine Rser=18m
SYMBOL res 1008 16 R0
SYMATTR InstName R5
SYMATTR Value 1Meg
SYMBOL res 1008 176 R0
SYMATTR InstName R6
SYMATTR Value 1Meg
SYMBOL bi 1328 112 M180
WINDOW 0 24 80 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName B1
SYMATTR Value I=min(V(CURR), if(V(CAP)<2.1,3,6))
SYMBOL bv 1872 16 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
SYMATTR InstName B2
SYMATTR Value V=V(CAP)
SYMBOL voltage 1872 48 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 6
SYMBOL res 2224 32 R0
SYMATTR InstName R1
SYMATTR Value 100k
SYMBOL res 432 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 100
SYMBOL pnp 384 464 M180
SYMATTR InstName Q1
SYMATTR Value 2SAR562F3
SYMBOL res 432 208 R0
SYMATTR InstName R7
SYMATTR Value 0.2
SYMBOL res 432 16 R0
SYMATTR InstName R8
SYMATTR Value 0.2
SYMBOL npn 384 -112 R0
SYMATTR InstName Q2
SYMATTR Value 2SCR562F3
SYMBOL TLV9302 0 160 R0
SYMATTR InstName U1
SYMBOL OpAmps\\UniversalOpAmp3 2176 32 R0
SYMATTR InstName U2
SYMBOL res 2048 0 R90
WINDOW 0 1 89 VRight 2
WINDOW 3 3 24 VLeft 2
SYMATTR InstName R9
SYMATTR Value 1k
SYMBOL res 2048 32 R90
WINDOW 0 1 89 VRight 2
WINDOW 3 3 24 VLeft 2
SYMATTR InstName R10
SYMATTR Value 1k
SYMBOL res 2112 48 M0
SYMATTR InstName R11
SYMATTR Value 1Meg
SYMBOL res 2224 -96 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R12
SYMATTR Value 1Meg
SYMBOL cap 2208 -224 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value 10n
SYMBOL voltage 528 -208 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 6
SYMBOL bv 304 560 R0
SYMATTR InstName B3
SYMATTR Value V=Ie(Q1)*V(SP)
SYMBOL bv 672 560 R0
SYMATTR InstName B4
SYMATTR Value V=(V(FB)-V(SP))*Ie(Q1)
SYMBOL bv 304 800 R0
SYMATTR InstName B5
SYMATTR Value V=(V(6V)-V(SN))*Ic(Q2)
SYMBOL bv 672 800 R0
SYMATTR InstName B6
SYMATTR Value V=(V(SN)-V(FB))*Ic(Q2)
SYMBOL res -112 128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R727
SYMATTR Value 100
SYMBOL cap 16 -64 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 1n
SYMBOL bv 1088 800 R0
SYMATTR InstName B7
SYMATTR Value V=idt(V(P_NPN)+V(P_PNP))
TEXT -408 408 Left 2 !.tran 0 300 1m uic
TEXT 760 -112 Left 2 !.ic V(CAP)=0 V(FB)=0
TEXT 768 368 Left 2 !.param A=1.05 B=0.98
TEXT 1800 -264 Bottom 2 ;Mocked up ideal charger
RECTANGLE Normal 2352 192 1200 -256 2
